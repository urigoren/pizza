<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pizza + Dancing Triangles (actually visible)</title>
  <style>
    html, body { margin:0; height:100%; background:#000; overflow:hidden; }
    canvas { display:block; width:100vw; height:100vh; background:#000; }
    .hint {
      position: fixed; left: 12px; bottom: 12px;
      font: 12px/1.2 system-ui, sans-serif; color: rgba(255,255,255,.7);
      user-select: none;
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div class="hint">Space = pause • R / Click = reseed</div>

<script>
(function () {
  var canvas = document.getElementById('c');
  var ctx = canvas.getContext('2d');

  if (!ctx) {
    // If this happens, your browser is basically a fossil.
    document.body.innerHTML = '<div style="color:#fff;font:16px system-ui;padding:16px">No 2D canvas context available.</div>';
    return;
  }

  var W=0, H=0, DPR=1;

  function resize() {
    DPR = Math.min(2, window.devicePixelRatio || 1);
    W = Math.floor(window.innerWidth * DPR);
    H = Math.floor(window.innerHeight * DPR);
    canvas.width = W;
    canvas.height = H;
  }
  window.addEventListener('resize', resize);
  resize();

  // Seeded RNG
  var seed = (Math.random() * 1e9) | 0;
  function rnd() {
    seed ^= seed << 13; seed |= 0;
    seed ^= seed >> 17; seed |= 0;
    seed ^= seed << 5;  seed |= 0;
    return ((seed >>> 0) / 4294967296);
  }
  function rand(a,b){ return a + (b-a)*rnd(); }
  function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }
  function lerp(a,b,t){ return a + (b-a)*t; }

  // Fake beat pulse
  var BPM = 122;
  var beatHz = BPM / 60;
  function beatPulse(t) {
    var ph = (t * beatHz) % 1;                // 0..1
    var kick = Math.exp(-ph * 10.0);
    var sn   = Math.exp(-Math.pow(ph - 0.52, 2) * 90.0);
    var hat  = Math.exp(-Math.pow(ph - 0.25, 2) * 180.0) + Math.exp(-Math.pow(ph - 0.75, 2) * 180.0);
    return clamp(0.95*kick + 0.55*sn + 0.20*hat, 0, 1.35);
  }

  // Pizza slice
  function drawPizzaSlice(cx, cy, R, aMid, wedge, pulse, alpha) {
    var a0 = aMid - wedge*0.5;
    var a1 = aMid + wedge*0.5;

    // Tip point slightly away from center
    var tipR = R * 0.08;
    var tipX = cx + Math.cos(aMid) * tipR;
    var tipY = cy + Math.sin(aMid) * tipR;

    var p0x = cx + Math.cos(a0)*R;
    var p0y = cy + Math.sin(a0)*R;
    var p1x = cx + Math.cos(a1)*R;
    var p1y = cy + Math.sin(a1)*R;

    ctx.save();
    ctx.globalAlpha = alpha;

    // Cheese fill
    var g = ctx.createRadialGradient(
      lerp(tipX, cx, 0.35),
      lerp(tipY, cy, 0.35),
      R*0.03,
      cx, cy, R*1.1
    );
    g.addColorStop(0.00, 'rgba(255, 240, 190, 1.00)');
    g.addColorStop(0.60, 'rgba(250, 200, 120, 0.95)');
    g.addColorStop(1.00, 'rgba(180, 90, 55, 0.55)');
    ctx.fillStyle = g;

    ctx.beginPath();
    ctx.moveTo(tipX, tipY);
    ctx.lineTo(p0x, p0y);
    ctx.arc(cx, cy, R, a0, a1);
    ctx.closePath();
    ctx.fill();

    // Sauce near tip
    ctx.globalAlpha = alpha * 0.55;
    ctx.fillStyle = 'rgba(210, 60, 45, 0.75)';
    ctx.beginPath();
    ctx.moveTo(tipX, tipY);
    ctx.lineTo(cx + Math.cos(a0)*R*0.55, cy + Math.sin(a0)*R*0.55);
    ctx.lineTo(cx + Math.cos(a1)*R*0.55, cy + Math.sin(a1)*R*0.55);
    ctx.closePath();
    ctx.fill();

    // Crust arc (this is what makes it unmistakably “pizza”)
    ctx.globalAlpha = alpha * (0.85 + 0.35*pulse);
    ctx.lineCap = 'round';
    ctx.strokeStyle = 'rgba(210, 140, 70, 0.95)';
    ctx.lineWidth = (R * 0.13) * (0.9 + 0.15*pulse);
    ctx.beginPath();
    ctx.arc(cx, cy, R, a0, a1);
    ctx.stroke();

    // Pepperoni
    ctx.globalAlpha = alpha * (0.55 + 0.25*pulse);
    for (var i=0;i<4;i++){
      var t = (i+1)/5;
      var rr = R * (0.06 + 0.01*rnd());
      var px = lerp(tipX, cx + Math.cos(aMid)*R*0.78, t) + (rnd()-0.5)*R*0.08;
      var py = lerp(tipY, cy + Math.sin(aMid)*R*0.78, t) + (rnd()-0.5)*R*0.08;

      // keep inside wedge by pulling angle toward aMid
      var ang = Math.atan2(py-cy, px-cx);
      var off = clamp(ang - aMid, -wedge*0.30, wedge*0.30);
      var rad = Math.hypot(px-cx, py-cy);
      px = cx + Math.cos(aMid + off) * rad;
      py = cy + Math.sin(aMid + off) * rad;

      ctx.fillStyle = 'rgba(165, 35, 35, 0.90)';
      ctx.beginPath();
      ctx.ellipse(px, py, rr*1.1, rr, rand(-0.4,0.4), 0, Math.PI*2);
      ctx.fill();

      ctx.fillStyle = 'rgba(255, 210, 200, 0.20)';
      ctx.beginPath();
      ctx.ellipse(px-rr*0.15, py-rr*0.12, rr*0.55, rr*0.45, 0, 0, Math.PI*2);
      ctx.fill();
    }

    ctx.restore();
  }

  // Dancing triangle “characters”
  var dancers = [];
  for (var i=0;i<40;i++){
    dancers.push({
      x: rand(0.10, 0.90),
      y: rand(0.22, 0.88),
      size: rand(18, 54),
      phase: rand(0, Math.PI*2),
      sway: rand(0.8, 2.2),
      hop:  rand(0.9, 2.8),
      mood: rand(0, 1)
    });
  }

  function drawDancer(x,y,sz,t,pulse,mood){
    var bounce = (0.7 + 1.0*pulse) * Math.abs(Math.sin(t*3.1 + mood*6.0));
    var rot = 0.55*Math.sin(t*1.2 + mood*5.0) + 0.25*Math.sin(t*2.1 + mood*9.0);

    ctx.save();
    ctx.translate(x, y - bounce*sz*0.22);
    ctx.rotate(rot);

    // Body gradient so it reads as a “thing”
    var g = ctx.createLinearGradient(0, -sz, 0, sz);
    g.addColorStop(0, 'rgba(200, 255, 255, 0.95)');
    g.addColorStop(1, 'rgba(120, 190, 255, 0.55)');
    ctx.fillStyle = g;

    // Triangle
    ctx.beginPath();
    ctx.moveTo(0, -sz*0.70);
    ctx.lineTo(-sz*0.65, sz*0.55);
    ctx.lineTo(sz*0.65, sz*0.55);
    ctx.closePath();
    ctx.fill();

    // Outline
    ctx.globalAlpha = 0.65;
    ctx.strokeStyle = 'rgba(255,255,255,0.75)';
    ctx.lineWidth = Math.max(1, 1.2*DPR);
    ctx.stroke();

    // Eyes
    ctx.globalAlpha = 0.55;
    ctx.fillStyle = 'rgba(20, 30, 40, 0.65)';
    ctx.beginPath(); ctx.arc(-sz*0.15, -sz*0.05, Math.max(1.2, sz*0.05)*DPR, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc( sz*0.15, -sz*0.05, Math.max(1.2, sz*0.05)*DPR, 0, Math.PI*2); ctx.fill();

    // Legs stepping
    var step = 0.55*Math.sin(t*4.0 + mood*8.0);
    var legLen = sz*0.55*(0.85 + 0.35*pulse);

    ctx.globalAlpha = 0.7;
    ctx.strokeStyle = 'rgba(255,255,255,0.65)';
    ctx.lineWidth = Math.max(1, 1.1*DPR);
    ctx.lineCap = 'round';

    ctx.beginPath();
    ctx.moveTo(-sz*0.15, sz*0.55);
    ctx.lineTo(-sz*0.15 + step*sz*0.22, sz*0.55 + legLen);
    ctx.moveTo( sz*0.15, sz*0.55);
    ctx.lineTo( sz*0.15 - step*sz*0.22, sz*0.55 + legLen);
    ctx.stroke();

    ctx.restore();
  }

  // Controls
  var paused = false;
  window.addEventListener('keydown', function(e){
    if (e.code === 'Space') paused = !paused;
    if ((e.key || '').toLowerCase() === 'r') seed = (Math.random()*1e9)|0;
  });
  window.addEventListener('click', function(){
    seed = (Math.random()*1e9)|0;
  });

  // Main loop
  var t0 = performance.now();

  // One-time clear so first frame is visible
  ctx.fillStyle = '#06060a';
  ctx.fillRect(0,0,W,H);

  console.log('[pizza_triangles] running');

  function loop(now){
    window.requestAnimationFrame(loop);
    if (paused) return;

    var t = (now - t0) / 1000;
    var pulse = beatPulse(t);

    // Solid-ish fade so drawings remain visible
    ctx.fillStyle = 'rgba(6, 6, 10, 0.22)';
    ctx.fillRect(0,0,W,H);

    // Pizza “wheel”
    var pcx = W*0.52;
    var pcy = H*0.48;
    var baseR = Math.min(W,H) * (0.24 + 0.04*Math.sin(t*0.7));
    var slices = 8;
    var spin = t*0.35;

    for (var s=0;s<slices;s++){
      var aMid = spin + (s/slices)*Math.PI*2;
      var wedge = (Math.PI*2 / slices) * 0.92;
      var alpha = 0.55 + 0.25*pulse; // IMPORTANT: visible
      drawPizzaSlice(pcx, pcy, baseR*(0.92 + 0.18*pulse), aMid, wedge, pulse, alpha);
    }

    // Dancing triangles
    for (var i=0;i<dancers.length;i++){
      var d = dancers[i];
      var sway = 0.035*Math.sin(t*d.sway + d.phase);
      var hop  = 0.030*Math.abs(Math.sin(t*d.hop + d.phase));
      var x = (d.x + sway) * W;
      var y = (d.y - hop*(1.0+0.8*pulse)) * H;
      var sz = d.size * (0.85 + 0.55*pulse);

      // Make them pop
      ctx.save();
      ctx.globalAlpha = 0.55 + 0.35*pulse;
      ctx.shadowBlur = (10 + 20*pulse) * DPR;
      ctx.shadowColor = 'rgba(110, 220, 255, 0.65)';
      drawDancer(x, y, sz, t, pulse, d.mood);
      ctx.restore();
    }
  }

  window.requestAnimationFrame(loop);
})();
</script>
</body>
</html>